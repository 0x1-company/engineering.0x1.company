# リファクタリングプラン

このドキュメントは、ONE Engineering ブログサイトのリファクタリング計画をチェックリスト形式でまとめたものです。

## 🎯 リファクタリングの目標

- [x] コードの保守性向上
- [x] パフォーマンスの最適化
- [x] 型安全性の強化
- [ ] 開発体験の改善
- [ ] テスト可能性の向上

## 📋 Phase 1: コード品質とアーキテクチャの改善

### 1.1 TypeScript型定義の強化

- [x] `app/types/` ディレクトリの型定義を見直し
  - [x] `Frontmatter` 型の必須プロパティを明確化
  - [x] `Article` 型にバリデーション機能を追加
  - [x] 共通の型定義を `types/common.ts` に統合
- [x] `any` 型の使用箇所を特定し、適切な型に置換
- [x] 型ガードの実装
  - [x] フロントマターのバリデーション関数
  - [x] 記事データの型安全性チェック

### 1.2 エラーハンドリングの改善

- [x] `app/lib/articles.ts` のエラーハンドリング強化
  - [x] ファイル読み込みエラーの適切な処理
  - [x] 不正なフロントマターの検証
  - [x] 存在しない記事へのアクセス処理
- [x] カスタムエラークラスの実装
- [x] エラーバウンダリーコンポーネントの追加

### 1.3 パフォーマンス最適化

- [x] 記事データの取得最適化
  - [x] `getArticles()` 関数のメモ化実装
  - [x] 不要なファイル読み込みの削減
  - [x] 記事一覧のページネーション実装
- [x] 画像最適化
  - [x] Next.js Image コンポーネントの活用
  - [x] WebP形式への変換
  - [x] 遅延読み込みの実装
- [x] バンドルサイズの最適化
  - [x] 未使用依存関係の削除
  - [x] 動的インポートの活用

## 📋 Phase 2: コンポーネント設計の改善

### 2.1 Atomic Design の見直し

- [x] コンポーネントの責務を再定義
  - [x] Atoms: 基本的なUI要素のみに限定
  - [x] Molecules: 単一の機能を持つ複合コンポーネント
  - [x] Organisms: ビジネスロジックを含む複雑なコンポーネント
- [x] コンポーネント間の依存関係を整理
- [x] 再利用可能なコンポーネントの抽出

### 2.2 Props インターフェースの統一

- [x] 全コンポーネントのProps型定義を見直し
- [x] 共通のProps（className, children等）の統一
- [x] オプショナルプロパティのデフォルト値設定
- [x] Props のバリデーション実装

### 2.3 スタイリングの統一

- [x] Tailwind CSS クラスの整理
  - [x] カスタムコンポーネントクラスの定義
  - [x] レスポンシブデザインの統一
  - [x] ダークモード対応の準備
- [x] CSS変数の活用
- [x] デザインシステムの構築

## 📋 Phase 3: 開発体験の向上

### 3.1 開発ツールの導入

- [ ] Biome の導入と設定
  - [ ] TypeScript専用ルールの設定
  - [ ] React Hooks ルールの設定
  - [ ] アクセシビリティルールの追加
  - [ ] フォーマッター機能の活用（Prettier代替）
- [ ] Husky + lint-staged の設定
- [x] コミットメッセージの規約化

### 3.2 テスト環境の構築

- [ ] Bun test + @testing-library/react の設定
  - [ ] Bunの組み込みテストランナーの活用
  - [ ] React Testing Libraryの導入
  - [ ] happy-domによるDOM環境のセットアップ
- [ ] コンポーネントテストの実装
  - [ ] Atoms レベルのテスト
  - [ ] Molecules レベルのテスト
  - [ ] Organisms レベルのテスト
- [ ] ユーティリティ関数のテスト
- [ ] E2Eテストの検討（Playwright）

### 3.3 開発環境の改善

- [ ] Storybook の導入検討
- [ ] 開発用のモックデータ作成
- [ ] ホットリロードの最適化
- [ ] デバッグツールの整備

## 📋 Phase 4: SEO・アクセシビリティの強化

### 4.1 SEO最適化

- [ ] メタデータの動的生成改善
- [ ] 構造化データの実装
- [ ] サイトマップの自動生成
- [ ] robots.txt の最適化
- [ ] Core Web Vitals の改善

### 4.2 アクセシビリティ向上

- [ ] ARIA属性の適切な実装
- [ ] キーボードナビゲーションの改善
- [ ] スクリーンリーダー対応
- [ ] カラーコントラストの確認
- [ ] フォーカス管理の改善

### 4.3 国際化対応の準備

- [ ] i18n ライブラリの検討
- [ ] 多言語対応の設計
- [ ] 日本語フォントの最適化

## 📋 Phase 5: 運用・保守性の向上

### 5.1 監視・ログ機能

- [ ] エラー監視ツールの導入（Sentry等）
- [ ] パフォーマンス監視の実装
- [ ] アクセス解析の改善
- [ ] ログ出力の標準化

### 5.2 CI/CD パイプラインの改善

- [ ] GitHub Actions の最適化
- [ ] Biome による自動リント・フォーマットチェック
- [ ] 自動テストの実行
- [ ] 自動デプロイの改善
- [ ] セキュリティスキャンの追加

### 5.3 ドキュメント整備

- [ ] API ドキュメントの作成
- [ ] コンポーネントドキュメントの整備
- [ ] 開発ガイドラインの更新
- [ ] トラブルシューティングガイドの作成

## 📋 Phase 6: 新機能・拡張性の準備

### 6.1 CMS連携の準備

- [ ] ヘッドレスCMS対応の設計
- [ ] 記事管理インターフェースの検討
- [ ] プレビュー機能の実装

### 6.2 検索機能の実装

- [ ] 全文検索の実装
- [ ] タグ・カテゴリ機能
- [ ] フィルタリング機能

### 6.3 ユーザー体験の向上

- [ ] 読み込み状態の改善
- [ ] オフライン対応（PWA化）
- [ ] 記事の共有機能強化
- [ ] コメント機能の検討

## 🚀 実装優先度

### 高優先度（Phase 1-2）
- TypeScript型定義の強化
- エラーハンドリングの改善
- パフォーマンス最適化
- コンポーネント設計の見直し

### 中優先度（Phase 3-4）
- テスト環境の構築
- SEO・アクセシビリティの強化
- 開発ツールの導入

### 低優先度（Phase 5-6）
- 監視・ログ機能
- 新機能の実装
- 拡張性の準備

## 📝 注意事項

- 各フェーズは段階的に実装し、動作確認を行う
- 既存機能への影響を最小限に抑える
- パフォーマンスの劣化がないか定期的に確認
- チーム内でのコードレビューを徹底する
- ユーザーへの影響を考慮したリリース計画を立てる

## 📊 進捗管理

各項目の完了時には以下を記録：
- 完了日
- 実装者
- 関連するPR番号
- 動作確認結果
- 発見された課題

---

*最終更新: 2025-01-27*
*作成者: Claude AI*

## Phase 2 完了項目の詳細

### 実装された新規コンポーネント

#### Atoms
- Badge.tsx - ステータスバッジコンポーネント
- Separator.tsx - 区切り線コンポーネント
- ListItem.tsx - リストアイテムコンポーネント

#### Molecules
- TagList.tsx - タグ一覧表示コンポーネント
- MetaInfo.tsx - メタ情報統一表示コンポーネント

### 修正されたコンポーネント
- NavLink.tsx - `<li>`要素を外部に移動
- FooterNavLink.tsx - `<li>`要素を外部に移動
- Icon.tsx - 'user'と'clock'アイコンタイプを追加
- Button.tsx - サイズプロパティの型定義を修正

### 追加されたユーティリティ
- lib/utils/styles.ts - cn関数とデザイントークン
- types/component-props.ts - 共通Props定義

### 依存関係の追加
- clsx - クラス名の条件付き結合
- tailwind-merge - Tailwindクラスの最適化

## Phase 2 残り項目の完了詳細

### 実装されたバリデーションシステム
- `lib/utils/validation.ts` - 包括的なPropsバリデーションユーティリティ
- ValidationErrorクラス - カスタムエラー処理
- validateRequired, validateString, validateNumber等の型別バリデーター
- コンポーネントへの適用（Button, Image, ArticleCard）

### ダークモード対応の準備
- Tailwind設定で`darkMode: 'class'`を有効化
- ダークモード用カラーパレットの定義
- ThemeProviderとuseThemeフックの実装
- ThemeToggleコンポーネントの作成
- Iconコンポーネントに新アイコン（sun, moon, computer）追加

### デザインシステムの構築
- `lib/design-system/tokens.ts` - 統一されたデザイントークン
  - カラーパレット（ブランド、ライト/ダーク、ステータス）
  - タイポグラフィ（fontSize, fontWeight, lineHeight, fontFamily）
  - スペーシング、境界線、シャドウ、アニメーション
  - ブレークポイント、z-index
- `lib/design-system/index.ts` - デザインシステムユーティリティ
  - themeColor関数 - テーマ対応カラークラス生成
  - responsive関数 - レスポンシブクラス生成
  - componentVariants - コンポーネント別バリアント定義 