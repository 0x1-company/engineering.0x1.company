---
title: "Google Workspaceã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸€æ‹¬ä½œæˆã‚’è‡ªå‹•åŒ–"
description: "gcloud CLI ã¨ Cloud Identity API ã‚’ä½¿ã„ã€å¤§é‡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’è‡ªå‹•ã§ä½œæˆã™ã‚‹æ‰‹é †ã‚’è§£èª¬ã—ã¾ã™ã€‚"
date: "2025-05-09"
author: tomokisun
---

## ã¯ã˜ã‚ã«

ã‚ãŸã—ãŸã¡ã®ãƒãƒ¼ãƒ ã§ã¯ã€ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä¸€æ‹¬ã§ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã—ãŸã€‚ã—ã‹ã— Google Workspace ã®ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§1ä»¶ãšã¤æ“ä½œã™ã‚‹ã®ã¯ç«¯çš„ã«ã‚ã‚“ã©ãã•ã„ã§ã™ã€‚ãã“ã§ **GCP + Workspace API** ã‚’æ´»ç”¨ã—ã€è‡ªå‹•åŒ–ã—ãŸã®ãŒä»Šå›ã®è¨˜äº‹ã®èƒŒæ™¯ã§ã™ã€‚

## 4 ãƒ•ã‚§ãƒ¼ã‚ºã®å…¨ä½“åƒ

1. **"ç®¡ç†ç”¨" Google Cloud ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹**
2. **å¿…è¦ãª Workspace API ã‚’æœ‰åŠ¹åŒ– & ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™ºè¡Œ**
3. **Workspace å´ã§ "ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¯ã‚¤ãƒ‰å§”ä»»" ã‚’è¨±å¯**
4. **CLIï¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦å®Ÿè¡Œã™ã‚‹**

---

## 1. ç®¡ç†ç”¨ GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ

```bash
gcloud projects create admin-automation \
  --name="Admin Automation"

gcloud config set project admin-automation
```

---

## 2. API æœ‰åŠ¹åŒ– & ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæº–å‚™

### 2-1. API ã‚’ ON

```bash
gcloud services enable \
  cloudidentity.googleapis.com \  # Groups API
  admin.googleapis.com \          # Admin SDK Directory API
  groupssettings.googleapis.com   # Group Settings API
```

### 2-2. ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ

```bash
gcloud iam service-accounts create gw-admin-bot \
  --display-name="GW Admin Bot"

# éµã‚’ JSON ã§ç™ºè¡Œï¼ˆCI ã«ç½®ã or Secret Manager ã¸ï¼‰
gcloud iam service-accounts keys create sa-key.json \
  --iam-account gw-admin-bot@admin-automation.iam.gserviceaccount.com
```

### 2-3. æœ€ä½é™ä»˜ã‘ã‚‹ IAM ãƒ­ãƒ¼ãƒ«

| ç›®çš„ | ãƒ­ãƒ¼ãƒ« |
| --- | --- |
| API å‘¼ã³å‡ºã—è¨±å¯ | `roles/iam.serviceAccountTokenCreator`ï¼ˆæœ¬äººã«å¯¾ã—ã¦ï¼‰ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é–²è¦§ | `roles/viewer` ãªã©æœ€ä½é™ã§ OK |

---

## 3. Workspace å´ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¯ã‚¤ãƒ‰å§”ä»»

1. ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ« â†’ **[ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£] â†’ [API åˆ¶å¾¡] â†’ [ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¯ã‚¤ãƒ‰å§”ä»»]**
2. **[æ–°ã—ã„å§”ä»»ã‚’è¿½åŠ ]** â†’ *Client ID* ã«å…ˆã»ã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã® **ãƒ¦ãƒ‹ãƒ¼ã‚¯ ID** ã‚’å…¥åŠ›ï¼ˆãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã§ã¯ãªã„ï¼‰ã€‚
3. **OAuth ã‚¹ã‚³ãƒ¼ãƒ—** ã«ä¸‹è¨˜ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§ç™»éŒ²ï¼š

```text
https://www.googleapis.com/auth/cloud-identity.groups,
https://www.googleapis.com/auth/cloud-identity.groups.readonly,
https://www.googleapis.com/auth/admin.directory.group,
https://www.googleapis.com/auth/admin.directory.group.member,
https://www.googleapis.com/auth/apps.groups.settings
```

ğŸ’¡ **ãƒã‚¤ãƒ³ãƒˆ**

* Cloud Identity API ç”¨ã‚¹ã‚³ãƒ¼ãƒ—ã¨ Admin SDK ç”¨ã‚¹ã‚³ãƒ¼ãƒ—ã® **ä¸¡æ–¹** ãŒå¿…è¦ã€‚
* ã•ã‚‰ã«ã€Œã‚°ãƒ«ãƒ¼ãƒ—ç®¡ç†è€…ã€ã® **ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«** ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ä»˜ä¸ã—ã¦ãŠãã¨ UI ä¸Šã§ã‚‚æ¨©é™ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã€‚

---

## 4. ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè£…

### 4-1. gcloud CLI ã‚’ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§å®Ÿè¡Œ

```bash
gcloud auth activate-service-account \
  --key-file sa-key.json \
  --impersonate-service-account \
      gw-admin-bot@admin-automation.iam.gserviceaccount.com
```

ã“ã‚Œã§ **`gcloud identity groups â€¦`** ã‚³ãƒãƒ³ãƒ‰ãŒãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¯ã‚¤ãƒ‰æ¨©é™ã§å‹•ä½œã—ã¾ã™ã€‚

### 4-2. ä½œæˆã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
#!/usr/bin/env bash
# ä½œæˆã—ãŸã„ã‚°ãƒ«ãƒ¼ãƒ—
GROUP_EMAILS=(
"CVAUG006@example.com"
"CZMPC007@example.com"
)

## è¿½åŠ ã™ã‚‹ãƒ¡ãƒ³ãƒãƒ¼
MEMBERS=(
"alice@example.com"
"bob@example.com"
)

# ã™ã¹ã¦ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã—ã€ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ ã™ã‚‹
for group_email in "${GROUP_EMAILS[@]}"; do
  # ã‚°ãƒ«ãƒ¼ãƒ—åã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’æŠ½å‡ºï¼ˆä¾‹ï¼šCVAUG006ï¼‰
  prefix=$(echo "$group_email" | cut -d '@' -f 1)
  # ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›
  echo "ãƒ‡ãƒãƒƒã‚° - ã‚°ãƒ«ãƒ¼ãƒ—: $group_email, ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹: $prefix"
  
  display_name="prefix: $prefix"
  
  echo "ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ: $group_email ($display_name)"
  gcloud identity groups create "$group_email" \
    --display-name="$display_name" --organization="example.com"
  
  # ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸå ´åˆã¯å‡¦ç†ã‚’ç¶šè¡Œ
  if [ $? -ne 0 ]; then
    echo "è­¦å‘Š: ã‚°ãƒ«ãƒ¼ãƒ— $group_email ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ¬¡ã®ã‚°ãƒ«ãƒ¼ãƒ—ã«é€²ã¿ã¾ã™ã€‚"
    continue
  fi
  
  # ãƒ¡ãƒ³ãƒãƒ¼ã‚’è¿½åŠ 
  for member in "${MEMBERS[@]}"; do
    echo "ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ : $member â†’ $group_email"
    gcloud identity groups memberships add \
      --group-email="$group_email" \
      --member-email="$member" \
      --roles=MEMBER
  done
  
  echo "========================================"
 done
```

---

## ã¾ã¨ã‚

| ã‚¹ãƒ†ãƒƒãƒ— | ä¸»ãªä½œæ¥­ |
| --- | --- |
| **1. GCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ** | `gcloud projects create` ã§ç®¡ç†ç”¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ |
| **2. API & SA** | `gcloud services enable ...` â†’ ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™ºè¡Œ |
| **3. Workspace é€£æº** | ç®¡ç†ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¯ã‚¤ãƒ‰å§”ä»» + ç®¡ç†è€…ãƒ­ãƒ¼ãƒ«ä»˜ä¸ |
| **4. ã‚°ãƒ«ãƒ¼ãƒ—è‡ªå‹•åŒ–** | gcloud / Curl / GAM ã§ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä¸€æ‹¬ä½œæˆ |
